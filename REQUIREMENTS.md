# Payroll Calculator Requirements

This document outlines the requirements and expected behavior of the Payroll Calculator application.

## Application Purpose

The Payroll Calculator is designed to calculate employee salaries based on various input data such as working days, rates, tax classes, and overtime. The application reads data from CSV files, performs calculations according to a specific formula, and outputs the results to a CSV file.

## Input Files

The application requires the following input files in the `data/` directory:

### 1. main_data.csv

Contains basic information about employees.

**Format:**  
Name;Location;Employee ID;Tax Class;AT Level;Status;Days Worked;Phone Number;Birthday;Password

**Example:**  
Henner Römer;Leipzig;69819545;4;AT2;ACTIVE;19;0173965019;1978-08-07;JXXN3qnZgg  
Svenja Geisler;Berlin;45151585;1;AT2;ACTIVE;19;0155565119;1973-09-06;16lhR5Qt8M

**Fields:**
- **Name**: Employee's full name
- **Location**: City or region where the employee is based
- **Employee ID**: Unique identifier for the employee
- **Tax Class**: Tax class category
- **AT Level**: Salary level/classification
- **Status**: Employment status (`ACTIVE`, `INACTIVE`)
- **Days Worked**: Number of days the employee worked in the period
- **Phone Number**: Contact number
- **Birthday**: Date of birth in format `YYYY-MM-DD`
- **Password**: Password string

### 2. rate.csv

Contains information about employee rates.

**Format:**  
EMPLOYEE_ID;RATE;OVERTIME_RATE

**Example:**  
69819545;540;44  
45151585;183;34

**Fields:**
- **EMPLOYEE_ID**: Unique employee identifier  
- **RATE**: Monthly rate  
- **OVERTIME_RATE**: Hourly rate for overtime

### 3. calendar_data.csv

Contains detailed calendar data for each day in the pay period.

**Format:**  
YEAR;MONTH;DAY;DAY_OF_WEEK;HOLIDAY

**Example:**  
2025;12;31;WED;N  
2025;12;30;TUE;N  
2025;12;29;MON;N

**Fields:**
- **YEAR**: Year
- **MONTH**: Month number
- **DAY**: Day of the month
- **DAY_OF_WEEK**: Day of the week (e.g., MON, TUE)
- **HOLIDAY**: Indicates whether the day is a holiday (`Y` or `N`)


### 4. overtime_data.csv

Contains information about employee overtime hours on specific dates.

**Format:**  
EMPLOYEE_ID;OVERTIME_DATA;DATE

**Example:**  
46771500;10;2025-05-20  
71123410;10;2025-05-09

**Fields:**
- **EMPLOYEE_ID**: Unique employee identifier
- **OVERTIME_DATA**: Number of overtime hours
- **DATE**: Date when the overtime occurred (`YYYY-MM-DD`)

### 5. tax_class_data.csv

Contains information about tax classes and their coefficients.

**Format:**  
TAX_CLASS;FACTOR

**Example:**  
4;0.42  
3;0.35  
2;0.25  
1;0.15

**Fields:**
- **TAX_CLASS**: Tax class identifier
- **FACTOR**: Tax coefficient (used for tax calculation)

### 6. payments.csv

Specifies the official payment date for a given month and year.

**Format:**  
MONTH;YEAR;PAYMENT_DATE

**Example:**  
1;2025;15

**Fields:**
- **MONTH**: Month number
- **YEAR**: Year
- **PAYMENT_DATE**: Day of the month when payment is made

## Output File

The application generates the following output file in the `data/result/` directory:

### main_data_result.csv

Contains the calculated salary information.

**Format:**
```
EMPLOYEE_ID;PAY;DATA;SETTLEMENT_ACCOUNT;CURRENCY
```

**Example:**
```
123;178.80;1.15.2025;SMIT;EUR
124;277.50;1.15.2025;BROW;EUR
```

**Fields:**
- EMPLOYEE_ID: Unique employee identifier
- PAY: Calculated salary amount
- DATA: Payment date (MONTH.PAYMENT_DATE.YEAR)
- SETTLEMENT_ACCOUNT: Account identifier (derived from employee's name)
- CURRENCY: Currency code (always EUR)

## Calculation Logic

### Salary Formula

The salary calculation uses the following formula with clear variable names:

```
Salary = (Dworked / Dtotal) × Rmonthly × Tcoef + Σ(Hovertime × Rovertime × 1.5)
```

Where:
- **Dworked** - Number of days worked by the employee (from main_data.csv)
- **Dtotal** - Total number of working days in the month (from calendar_data.csv)
- **Rmonthly** - Employee's monthly rate (from rate.csv)
- **Tcoef** - Tax coefficient based on tax class (from tax_class_data.csv)
- **Hovertime** - Overtime hours, limited to maximum 10 hours (from overtime_data.csv)
- **Rovertime** - Overtime hourly rate (from rate.csv)
- **1.5** - Fixed coefficient for overtime calculations

### Settlement Account Generation

The settlement account is generated by taking the first 4 letters of the employee's full name in uppercase.

### Special Cases

1. **Inactive Employees**: Employees with STATUS=INACTIVE are excluded from salary calculations.
2. **Maximum Overtime**: Overtime hours are capped at 10 hours maximum.
3. **Missing Data**: If an employee is missing from any of the required input files, they may be excluded from calculations or receive incorrect results.

## Error Handling

The application logs errors but generally attempts to continue processing rather than terminating immediately. This means:

1. If an input file is missing or corrupt, the application will log an error but may continue with partial data.
2. If there are data inconsistencies (e.g., employee exists in main data but not in rates), the application will log warnings but continue processing other employees.
3. If there are parsing errors in the CSV files, the application will attempt to handle them gracefully where possible.

## Logging

The application logs its operation at various levels:
- INFO: General operation information
- WARN: Issues that don't prevent operation but may indicate problems
- ERROR: Serious issues that affect calculation results
- DEBUG: Detailed information useful for troubleshooting

Logs are written to both the console and a log file.

## Configuration

The application configuration is defined in the source code with constants for file paths and calculation parameters. To change these configurations, you need to modify the constants in the source code and recompile the application.

## Test Process

To verify that the application is functioning correctly:

1. Place test data in the `data/` directory
2. Run the application
3. Check the output file in `data/result/main_data_result.csv`
4. Verify calculations manually for a sample of employees
5. Review the log files for any warnings or errors